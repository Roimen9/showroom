<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Discover the best car dealership in Nairobi for new and used cars, including Toyota models. Explore second-hand autos, affordable vehicles, and installment options. Find cheap cars for sale near you, top deals, and reliable car dealerships in Kenya. Your trusted source for buying cars with monthly payments or finding used cars for sale near me." />
    <meta name="title" content="Car Dealership Nairobi | New and Used Cars for Sale">
    <meta name="description" content="Explore the best car dealership in Nairobi for new and used cars. Find Toyota models, second-hand autos, and installment plans. Your go-to car dealership in Kenya." />
    <title>Vehicles</title>
    <link defer href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://res.cloudinary.com"/>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        img {
            aspect-ratio: auto 640 / 360;
        }
        .card-img-top {
          width: 100%;
          height: auto;
          object-fit: cover;
          border-radius: 8px 8px 0 0;
        }
      </style> 
      <script defer>
        (function(h,o,t,j,a,r){
            h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
            h._hjSettings={hjid:5297368,hjsv:6};
            a=o.getElementsByTagName('head')[0];
            r=o.createElement('script');r.async=1;
            r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
            a.appendChild(r);
        })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
      </script>     
</head>
<body class="bg-body-tertiary">
    <%- include('../partials/header') %>

    <div class="container mt-5 pt-5">
    <div class="mt-4 d-flex flex-row gap-3 align-items-center" style="overflow-x: scroll; scroll-behavior: smooth; scrollbar-width: none;">
        <select class="fs-5 border border-1 py-1 px-3 rounded-pill bg-body-tertiary text-center align-items-center" id="make" aria-label="Select vehicle make">
            <Option class="fs-5 text-start rounded-4" value="">Select make</Option>
            <Option class="text-start fs-5 btn btn-dark rounded-4" value="">Clear</Option>
            <Option class="text-start fs-5">Toyota</Option>
            <Option class="text-start fs-5">Mazda</Option>
            <Option class="text-start fs-5">Nissan</Option>
            <Option class="text-start fs-5">BMW</Option>
            <Option class="text-start fs-5">Honda</Option>
            <Option class="text-start fs-5">Lexus</Option>
            <Option class="text-start fs-5">Audi</Option>
            <Option class="text-start fs-5">Landrover</Option>
            <Option class="text-start fs-5">Chevrolet</Option>
            <Option class="text-start fs-5">Hyundai</Option>
        </select>
        <select class="fs-5 border border-1 py-1 px-3 rounded-pill bg-body-tertiary text-center align-items-center" id="price" aria-label="Select vehicle price">
            <Option class="fs-5 text-start rounded-4" value="">Price range</Option>
            <Option class="text-start fs-5 btn btn-dark rounded-4" value="">Clear</Option>
            <Option class="text-start fs-5" value="0-500000">0 - 500K</Option>
            <Option class="text-start fs-5" value="500000-1000000">500K - 1M</Option>
            <Option class="text-start fs-5" value="1000000-2000000">1M - 2M</Option>
            <Option class="text-start fs-5" value="2000000-3000000">2M - 3M</Option>
            <Option class="text-start fs-5" value="3000000-5000000">3M - 5M</Option>
            <Option class="text-start fs-5" value="5000000-10000000">5M - 10M</Option>
            <Option class="text-start fs-5" value="10000000-10000000000">Above 10M</Option>
        </select>        
        <select class="fs-5 border border-1 py-1 px-3 rounded-pill bg-body-tertiary text-center align-items-center" id="condition">
            <Option class="text-start fs-5" value="">Condition</Option>
            <Option class="text-start fs-5 btn btn-dark rounded-4" value="">Clear</Option>
            <Option class="text-start fs-5">New</Option>
            <Option class="text-start fs-5">Used</Option>
        </select>
        <select class="fs-5 border border-1 py-1 px-3 rounded-pill bg-body-tertiary text-center align-items-center" id="YOM" aria-label="Select vehicle year of manufacture">
            <Option class="fs-5 text-start rounded-4" value="">Select YOM</Option>
            <Option class="text-start fs-5 btn btn-dark rounded-4" value="">Clear</Option>
            <Option class="text-start fs-5">2010</Option>
            <Option class="text-start fs-5">2011</Option>
            <Option class="text-start fs-5">2012</Option>
            <Option class="text-start fs-5">2013</Option>
            <Option class="text-start fs-5">2014</Option>
            <Option class="text-start fs-5">2015</Option>
            <Option class="text-start fs-5">2016</Option>
        </select>
        <select class="fs-5 border border-1 py-1 px-3 rounded-pill bg-body-tertiary text-center align-items-center" id="color" aria-label="Select vehicle colour">
            <Option class="fs-5 text-start rounded-4" value="">Select colour</Option>
            <Option class="text-start fs-5 btn btn-dark rounded-4" value="">Clear</Option>
            <Option class="text-start fs-5">Red</Option>
            <Option class="text-start fs-5">Blue</Option>
            <Option class="text-start fs-5">Green</Option>
            <Option class="text-start fs-5">White</Option>
            <Option class="text-start fs-5">Grey</Option>
            <Option class="text-start fs-5">Maroon</Option>
            <Option class="text-start fs-5">Black</Option>
        </select>
        <select class="fs-5 border border-1 py-1 px-3 rounded-pill bg-body-tertiary text-center align-items-center">
            <Option class="text-start fs-5">Select model</Option>
        </select>
    </div>
    <div class="row mt-2">
        <input type="text" class="border border-1 rounded-4 ps-3 py-2 fs-5 ms-3 col-lg-2 col-8" placeholder="Search" id="search">            
    </div>
    <div class="container my-3">
        <div class="fs-4 h5 counter"><%= rows.length %> vehicles available</div>
    </div>
    <div class="row" id="vehicles">
      <% rows.forEach(row => { %>
        <a href="/user/vehicle/<%= row.Id %>" class="col-lg-3 col-md-6 col-12 mb-3 vehicle" style="text-decoration: none;"
            data-make="<%= row.make %>"
            data-yom="<%= row.YOM %>"
            data-colour="<%= row.exterior %>"
            data-condition="<%= row.condition %>"
            data-price="<%= row.price %>">
          <div class="card w-100 rounded-4">
              <link rel="preload" href="<%= row.image1 %>" as="image">
              <img src="<%= row.image1 %>" class="card-img-top bg-danger-subtle" alt="<%= row.exterior %> <%= row.YOM %> <%= row.make %> <%= row.model %>"
              <% if (row.Id === 1) { %>
               loading="eager"
              <% } %>
              loading="lazy">
              <div class="card-body">
                <h5 class="card-title"><%= row.make %> <%= row.model %></h5>
                <h4 class="card-subtitle">KSH <%= row.price %></h4>                     
              </div>
            </div>
        </a>
      <% }) %>
    <%- include('../partials/footer') %>    
</body>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const vehicleList = document.getElementById('vehicles')
            const counter = document.querySelector('.counter')
            const makeFilter = document.getElementById('make')
            const YOMFilter = document.getElementById('YOM')
            const priceFilter = document.getElementById('price')
            const colourFilter = document.getElementById('color')
            const conditionFilter = document.getElementById('condition')
            const searchBar = document.getElementById('search')
            
            let count = 0
            const vehicles = Array.from(vehicleList.getElementsByClassName('vehicle'))

            function filter() {
                const make = makeFilter.value.toLowerCase()
                const YOM = YOMFilter.value
                const colour = colourFilter.value.toLowerCase()
                const condition = conditionFilter.value.toLowerCase()
                const price = priceFilter.value
                const search = searchBar.value.toLowerCase()
                vehicles.forEach(vehicle => {
                    const matchMake = make ? vehicle.dataset.make.toLowerCase().includes(make) : true
                    const matchYOM = YOM ? vehicle.dataset.yom === YOM : true
                    const matchColour = colour ? vehicle.dataset.colour.toLowerCase().includes(colour) : true
                    const matchCondition = condition ? vehicle.dataset.condition.toLowerCase().includes(condition) : true
                    const matchSearch = search ? vehicle.textContent.toLowerCase().includes(search) : true
                    let matchPrice
                    if (price) {
                        const carPrice = vehicle.dataset.price.split(",").join("")
                        const values = price.split("-")
                        const valueNumber = []
                        values.forEach(number => {
                            const newNum = parseInt(number)
                            valueNumber.push(newNum)
                        })
                        if (carPrice > valueNumber[0] && carPrice <= valueNumber[1]) {
                            matchPrice = true
                        } else {
                            matchPrice = false
                        }
                    } else {
                        matchPrice = true
                    }
                    const matchAll = matchMake && matchSearch && matchYOM && matchColour && matchCondition && matchPrice 

                    vehicle.style.display = matchAll ? 'block' : 'none';
                    if (matchAll) count++
                })
                if (count === 1) {
                    counter.textContent = `${count} vehicle available`
                } else {
                    counter.textContent = `${count} vehicles available`
                }   
                count = 0
            }
            function debounce(fn, delay) {
                let timeout;
                return function (...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => fn(...args), delay);
                };
            }
            
            makeFilter.addEventListener("change", filter)
            colourFilter.addEventListener("change", filter)
            YOMFilter.addEventListener("change", filter)
            conditionFilter.addEventListener("change", filter)
            priceFilter.addEventListener("change", filter)
            searchBar.addEventListener("input", debounce(filter, 50));
        })
    </script>
</html>
